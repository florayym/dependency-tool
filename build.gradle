/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'java'
    id 'java-library-distribution'
    id 'maven-publish'
}

repositories {
    mavenLocal()
    maven {
        url = 'http://repo.maven.apache.org/maven2'
    }
}

dependencies {
    //    compile 'cn.emergentdesign.se:utils:0.0.1'
    implementation files('libs/antlr4-maven-plugin-4.7.2.jar')
    implementation files('libs/antlr4-runtime-4.8.jar')
    implementation files('libs/commons-io-2.6.jar')
    implementation files('libs/ehcache-core-2.5.1.jar')
    implementation files('libs/jackson-databind-2.9.10.5.jar')
    implementation files('libs/jackson-core-2.9.10.jar')
    implementation files('libs/jackson-annotations-2.9.10.jar')
    implementation files('libs/junit-4.12.jar')
    implementation files('libs/mockito-all-1.9.5.jar')
    implementation files('libs/picocli-3.8.2.jar')
    implementation files('libs/poi-3.16.jar')
    implementation files('libs/poi-ooxml-3.16.jar')
    implementation files('libs/slf4j-api-1.7.25.jar')
    implementation files('libs/slf4j-log4j12-1.7.25.jar')
    implementation files('libs/log4j-1.2.17.jar')
    implementation files('libs/backport-util-concurrent.jar')
    implementation files('libs/plexus-utils-3.3.0.jar')
    implementation files('libs/org.eclipse.cdt.core_6.9.0.201909091953.jar')
    implementation files('libs/org.eclipse.core.jobs_3.10.500.v20190620-1426.jar')
    implementation files('libs/org.eclipse.core.runtime_3.14.0.v20180417-0825-4.8.0.jar')
    implementation files('libs/org.eclipse.equinox.common_3.10.500.v20190815-1535.jar')
    implementation files('libs/org.eclipse.equinox.preferences_3.7.500.v20190815-1535.jar')
    implementation files('libs/org.eclipse.equinox.registry_3.8.500.v20190714-1850.jar')
    implementation files('libs/org.eclipse.core.resources_3.13.500.v20190819-0800.jar')
    implementation files('libs/org.eclipse.osgi_3.15.0.v20190830-1434.jar')
    implementation files('libs/commons-collections4-4.4.jar')
    implementation files('libs/jrubyparser-0.5.5-SNAPSHOT.jar')
    implementation files('libs/yydebug.jar')
    implementation files('libs/mysql-connector-java-8.0.13.jar')
}

jar {
    manifest {
        attributes (
                'Main-Class': 'depends.Main',
                'Class-Path': configurations.runtimeClasspath.files.collect { "lib/$it.name" }.join(' ')
        )
    }
}

group = 'cn.emergentdesign.se'
version = '0.9.6'
sourceCompatibility = '1.8'

// https://docs.gradle.org/current/userguide/building_java_projects.html#sec:java_packaging
publishing {
    publications {
        maven(MavenPublication) {
            from(components.java)
        }
    }
}

String distName = 'depends-dist'

distributions {
    main {
        baseName = distName
    }
}

// https://docs.gradle.org/current/userguide/working_with_files.html
task packageDistribution(type: Zip) {
    def libDir = "libs"
    archiveFileName = distName + ".zip"
    destinationDirectory = file("$projectDir")

    from("$buildDir/libs") {
        include "*.jar"
    }

    from(libDir) {
        include "*.jar"
        into("lib")
    }

    doLast {
        println archiveFileName.get()
        println relativePath(destinationDirectory)
        println relativePath(archiveFile)
    }
}

task unpackFiles(type: Copy) {
    from zipTree("$buildDir/distributions/" + distName + "-" + version + ".zip")
    into "$buildDir/distributions"
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}
